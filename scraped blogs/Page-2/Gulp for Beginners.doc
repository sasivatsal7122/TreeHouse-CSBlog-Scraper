Title: Gulp for Beginners



Setting up gulp using gulp.js

Introduction to gulp.js
What is gulp? According to their homepage (gulpjs.com), itâ€™sÂ a toolkit to automate & enhance your workflow.Â What exactly does that mean? Well, for medium to large-sized projects you may want to have a folder with all your styles and scripts minified. This can significantly decrease file sizes and is usually best practice when deploying your app. Gulp can do all the hard work for you. It can throw all your final code into a new folder, minify it, and even add extra things to make your code even better!
Iâ€™m going to take you through setting up a basic gulpfile for your own projects and apps. Once weâ€™re done, you should have a clear understanding of how gulp works as well as add even more features to make your gulpfile even more powerful. Letâ€™s get started!
If youâ€™d prefer to follow along with a video guide instead, take a look at this workshop!
Prerequisites
To get the most out of this content, it is advised you have a decent understanding of JavaScript as well as a basic understanding of Node.js and npm. If those topics arenâ€™t familiar to you or you need a refresher, Iâ€™ve provided some links to Treehouse resources below. ğŸ‘‡ğŸ¼
JavaScript BasicsNode.js Basicsnpm Basics
Getting Started
Github Repo
Above is the github repo if you need to check the code should you get stuck but I encourage you to read through this blog post and follow along in your own text editor. No need to clone the project down or check the code unless you need to.  Ready? Letâ€™s go!Â ğŸš€
On your desktop (or wherever youâ€™d like to store your project), create a new folder. Letâ€™s call itÂ gulpfile-setup. Once created, open it up in your text editor. Next weâ€™ll need to open up the terminal. Make sure youâ€™re inside your new projectâ€™s folder. To get things started, weâ€™ll need aÂ package.jsonÂ file. We can set that up pretty easily by runningÂ npm init -yÂ in the terminal.

Youâ€™ll notice aÂ package.jsonÂ file is automatically generated for you. Donâ€™t worry about itâ€™s contents as that isnâ€™t too important for this guide. It should look pretty similar to this:

Next, weâ€™ll need to install some packages for gulp via npm. This will create aÂ node_modulesÂ folder inside our project folder. Generally, this folder will have lots of packages inside and is usually not a good idea to be tracked with git. So letâ€™s first create aÂ .gitignoreÂ file inside our project. Once created, we can ignore our node modules folder by writingÂ ./node_modules

â­Â Pro tip: You may or may not be using git to track this project but itâ€™s always good practice to ignore your node_modules folder.
Next, letâ€™s install the npm packages weâ€™ll need to work with gulp. For this basic gulp setup, weâ€™ll be installing a package to compile our css to scss, add auto-prefixers to our compiled css, minify our css, and minify our javascript. So here are the packages weâ€™ll be installing. Iâ€™ll link the individual packages to their documentation on the gulp.js website:
gulpgulp-sasssassgulp-clean-cssÂ (minifies our css)gulp-autoprefixerÂ (adds auto-prefixers to our css)gulp-terserÂ (minifies our javascript)
You can install npm packages by runningÂ npm install {package name}. To install them, in your terminal, make sure youâ€™re in your projectâ€™s root directory. Then type the following:
npm install gulp gulp-sass sass gulp-clean-css gulp-autoprefixer gulp-terser

Be sure to check your terminalâ€™s output message to see if all the packages have been installed successfully. Additionally, you can check your projectâ€™sÂ package.jsonÂ file underÂ dependencies:

Donâ€™t worry if your packageâ€™s versions are different from what you see above.
Now that we have all the packages we need, letâ€™s setup our gulpfile.Â ğŸ˜
We can start by creating a new file in our projectâ€™s root directory:Â gulpfile.js. We will need to use some of the APIs that we have access to fromÂ gulp. We can create variables for them.
const { src, dest, series, watch } = require('gulp');

Basically what weâ€™re doing here is destructuring these APIs from the gulp package into variables;Â src,Â dest,Â series, &Â watch.
Letâ€™s go over these briefly before we use them:
src API:Â https://gulpjs.com/docs/en/api/src
Reading the above documentation may confuse you but basically what this does is gives us a way to give our gulpfile a source (src) directory/file to listen and check for changes. This will be clearer when we get into writing out the rest of our gulpfile.
dest API:Â https://gulpjs.com/docs/en/api/dest
This is much like the src API but instead of giving it a source directory or file, we give it a destination directory. Basically, when we access files from source and make our changes, where do we want to put it after? Thatâ€™s when we choose a destination. Makes sense?
series API:Â https://gulpjs.com/docs/en/api/series
The series API is an easy one. From gulpâ€™s documentation:Â Combines task functions and/or composed operations into larger operations that will be executed one after another, in sequential order.Â Which basically means we run a series of functions one after another as parameters. For example:Â series(func1, func2, func3)
watch API:Â https://gulpjs.com/docs/en/api/src
The watch API is another easy one. This one takes two parameters. The files/folder you want to watch changes for and then a task you want to run when those changes happen. Letâ€™s get started writing our gulpfile so we can see this in action.
Now that we can access our APIs fromÂ gulp, letâ€™s grab our npm packages we installed and assign them to variables.
Side Note:






To make this easier to understand and organized, I will keep all the packages associated with the styles for our project separate from the packages for our scripts.
These variables will act as methods (functions) for our packages. If this doesnâ€™t make sense to you, no worries! I will explain this as we go.






Also, you can name these variables anything you want. What I name them is just how I prefer to name them.
const scss = require('gulp-sass')(require('sass'));
This is ourÂ gulp-sassÂ package that also requires theÂ sassÂ package to work. This will compile our scss code into css for us.
const autoPrefixer = require('gulp-autoprefixer');
This is theÂ autoprefixerÂ package that will add prefixers to our compiled css.
const cssMinify = require('gulp-clean-css');
TheÂ clean-cssÂ package will minify our compiled css.

For our JavaScript, weâ€™ll just be minifying it.
const jsMinify = require('gulp-terser');
If everything was written correctly, yourÂ gulpfile.jsÂ should resemble this:

Great! Now letâ€™s start using everything. We will want to setup functions for our styles and scripts. This is how Iâ€™ve laid out my code:

The next step would be to give these functions a source directory/file, utilize our gulp methods, and then drop them in a destination directory. For this part, I recommend you set your folder structure up just as I have to make things easier. You can adjust this to your liking once youâ€™re more comfortable working with your gulpfile. Here is my directory structure:

You can see in my projectâ€™s root directory I have the following:
frontend (folder)node_modules (folder).gitignore (file)gulpfile.js (file)package-lock.json (file) (this is auto-generated)package.json (file)
Inside myÂ frontendÂ folder I have two more folders:
distsrc
(these are just what I decided to call them. You can name these anything but this is a very common naming convention).
Letâ€™s talk about these two folders.Â srcÂ will be where we work out of. This will have all of our scripts, styles, images, etc. When we need to write any styles or scripts, this is the folder we do it in. This will be what we link in our gulpâ€™sÂ srcÂ method soon.Â distÂ will be where we have gulp send our files once we add things like our compiled css, prefixers and minified versions of our code. We will use our gulpâ€™sÂ destÂ method for this. This may seem confusing right now but it will make sense shortly.
Letâ€™s start writing in ourÂ styles()Â function.
Basically, what we want from this function is to look for any of our scss partials, compile it to css, add prefixers, minify it, then throw it into ourÂ dist folder. So letâ€™s get started!
These functions will only do one main thing.Â ReturnÂ our finished product. So immediately inside the function we will write a return statement. What it will return is our source directory/file and then weâ€™ll want to chain on everything else (our gulp API methods and our destination directory). That will look something like this:
return src('./frontend/src/styles/')
For scss we will want to watch for all folders as well as files that end inÂ .scssÂ right? So what we can do is addÂ **/*.scssÂ after the path to our srcâ€™s styles folder.
return src('./frontend/src/styles/**/*.scss')
**Â tells gulp to include any folder in this directory (styles/) andÂ *.scssÂ tells it to grab any file in any of those folders with theÂ .scssÂ extension.

Now weâ€™ll want to start chaining our methods to this return statement so make sure not to include aÂ ;Â at the end of what weâ€™ve written so far.
To chain on another method we can useÂ .pipe();
Next, we will want to chain on our scss compiler. Remember we set up a variable namedÂ scssÂ earlier? I mentioned that those variables will be methods (functions) for our gulp packages. So when we need to use it, the standardÂ method()Â syntax is required. So chaining on ourÂ scssÂ method would look something like this:
.pipe(scss())
We basically put theÂ scssÂ method inside theÂ pipeÂ method. So now letâ€™s add in our other methods.
.pipe(scss())
.pipe(autoPrefixer())
.pipe(cssMinify())
You will need to add â€˜last 2 versionsâ€™ (as a string) to theÂ autoPrefixer()Â method as a parameter.Â autoPrefixer('last 2 versions')

Now all thatâ€™s left to do is add ourÂ dest()Â method and give it the path to ourÂ distÂ folder.
.pipe(dest('./frontend/dist/styles/'))
Even though we didnâ€™t create aÂ stylesÂ folder inside our dist folder, it will create it for us.
Your final code for theÂ stylesÂ function should look like this:

â­Â Give it a try â€“ Try setting up the scripts file on your own!Â â­
Why not take a stab at theÂ scriptsÂ function? This should be very straight-forward if you were able to follow along thus far. Give it a shot! inâ€¦Â 3â€¦2â€¦1.. GO!
How did you do? Were you able to figure it out on your own? Awesome!! Great work! If not, no worries! Weâ€™ll go over how to set it up. Itâ€™s really pretty simple. Just like with ourÂ stylesÂ function, we need to give it a source and destination and chain our methods in-between. In this case, our only method is theÂ jsMinify.
YourÂ sourceÂ should look like this:
return src('./frontend/src/scripts/**/*.js')
Then we chain our minifier method:
.pipe(jsMinify())
Then we chain on ourÂ destination:
.pipe(dest('./frontend/dist/scripts/'));

Great! Now we have our functions set up. Just like youâ€™re probably already used to, functions actually donâ€™t do anything unless we call them, right? Weâ€™ll want to call these two functions in a couple of ways. Once initially when the gulpfile is ran and then again each time a change is detected. To do the latter, weâ€™ll need to set up a watch task using theÂ watchÂ method that we imported from from gulp on the first line of ourÂ gulpfile.jsÂ code. Letâ€™s get started.
Letâ€™s set up a new function and name itÂ watchTask.
This function will do one thing, call ourÂ watchÂ method we imported from gulp.
function watchTask( watch(); );
TheÂ watchÂ method takes two parameters. The first is where we would like to watch for changes. In this case we want to watch for changes inÂ bothÂ our styles and scripts folder. So our first parameter can be an array pointed to those locations.
watch([ './frontend/src/styles/**/*.scss', './frontend/src/scripts/**/*.js' ])
our next parameter is what we want to do when ourÂ watchÂ method detects a change. Weâ€™ll want to call our functions, right? So letâ€™s call them. Weâ€™ll need to run a series of functions. (stylesÂ andÂ scripts). So now weâ€™ll use theÂ seriesÂ method we imported from gulp. That will look like this:
series(styles, scripts)
Pretty simple, right? Here is the finished code for ourÂ watchTaskÂ function:

The last part of this gulpfile is exporting all of our functions. We will use the series method for this again. That snippet of code will look like this:
exports.default = series(styles, scripts, watchTask);

Here is a look at the full code incase something in your application isnâ€™t working and you need a reference:


There we have it! Youâ€™ve written your first gulpfile! Feel free to checkout the gulp documentation for other helpful plugins like compressing images or even using babel. Now, letâ€™s see how we can run this gulpfile.


Go ahead and open up yourÂ package.jsonÂ file. In there youâ€™ll see a â€œscriptsâ€ object with a â€œtestâ€ key. You can actually delete â€œtestâ€ and itâ€™s value. Instead, create a new property called â€œstartâ€. For the value, write â€œnpm install && gulpâ€œ.Â npm installÂ will install all of your packages from your package.jsonâ€™s dependencies. (This is already done, but I like to keep this in myÂ startÂ command so that I install all my packages incase I am downloading this from a repo.)Â gulpÂ will run your gulpfile.
Should look like this if done correctly:

Next, we can open up our terminal and runÂ npm start.

If all goes well, you should see an output very similar to this in your terminal:

Woohoo! We now have a working gulpfile! To see it in action, letâ€™s create an scss stylesheet in our src folder. inside `frontend/src/styles/` create a file `app.scss` for example. Then add some standard css like so:

Hit save and then you should see a dist folder with a styles folder inside. Inside that styles folder you should see anÂ app.css file. The contents should have prefixers added to it and it should also be minified! Pretty cool, right?

Now, lets give this a try with our scripts. Letâ€™s create a file namedÂ app.jsÂ inside ofÂ /frontend/src/scripts/.
We can write a simple JS object:

We should see it inÂ /frontend/dist/scripts/app.js:


There you have it! A gulpfile that works to automate your workflow for you. This is a super simple gulpfile. How you craft your own personal gulpfile is completely up to you and what type of project youâ€™re building. Have fun with it and if you create something really neat, donâ€™t be shy! Share with the community via Slack. ğŸ™‚


